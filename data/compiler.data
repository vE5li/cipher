project { author "ve5li" contact "ve5li@tuta.io" name "cipher" } directories { core "/usr/share/cipher/data/core/" library "/usr/share/cipher/data/library/" passes "/usr/share/cipher/data/passes/" utility "/usr/share/shego/data/" } extentions { binary "out" cache "che" cipher "cip" data "data" intermediate "ll" object "elf" } command_lookup { debug { default !false environment "CIPHER_DEBUG" flag "-d" long "--debug" once !true } help { default !false environment "CIPHER_SHOW_HELP" flag "-h" long "--help" once !false } lucky { default !false environment "CIPHER_LUCKY" flag "-L" long "--lucky" once !true } output { default "output/" environment "CIPHER_OUTPUT_DIRECTORY" flag "-o" long "--output" once !true } source { default "source/" environment "CIPHER_SOURCE_DIRECTORY" flag "-s" long "--source" once !true } symbols { default !false environment "CIPHER_EXPORT_SYMBOLS" flag "-S" long "--symbols" once !true } } #functions { build [ [ #single name [ string ] ] [ #single configuration [ map ] ] #call [ #data verify ] [ #scope:name ] [ #scope:configuration ] #string [ #scope:configuration:output ] [ #scope:name ] [ #data '.' ] #modify [ #data #scope:_0 ] [ #last ] #modify [ #data #scope:base_file_name ] [ #scope:_0 ] #string [ #scope:base_file_name ] [ #root:extentions:intermediate ] #modify [ #data #scope:_1 ] [ #last ] #modify [ #data #scope:intermediate_file ] [ #scope:_1 ] #string [ #scope:base_file_name ] [ #root:extentions:object ] #modify [ #data #scope:_2 ] [ #last ] #modify [ #data #scope:object_file ] [ #scope:_2 ] #string [ #scope:base_file_name ] [ #root:extentions:binary ] #modify [ #data #scope:_3 ] [ #last ] #modify [ #data #scope:binary_file ] [ #scope:_3 ] #call [ #data shego:print_debug ] [ #data "creating object file..." ] #silent [ #data "llc" ] [ #scope:intermediate_file ] [ #data "-o" ] [ #scope:object_file ] [ #data "-filetype=obj" ] #modify [ #data #scope:_4 ] [ #last ] #modify [ #data #scope:status ] [ #scope:_4 ] #not [ #scope:status:success ] #if [ #data #true ] [ #last ] #print_line [ #data "failed to create object file" ] #if [ #data #true ] [ #scope:configuration:debug ] #print_line [ #scope:status:output ] #end #string [ #data "failed to build " ] [ #scope:name ] #modify [ #data #scope:_5 ] [ #last ] #error [ #scope:_5 ] #end #call [ #data shego:print_debug ] [ #data "creating binary file..." ] #silent [ #data "gcc" ] [ #scope:object_file ] [ #data "-o" ] [ #scope:binary_file ] [ #data "-no-pie" ] #modify [ #data #scope:_6 ] [ #last ] #modify [ #data #scope:status ] [ #scope:_6 ] #not [ #scope:status:success ] #if [ #data #true ] [ #last ] #print_line [ #data "failed to create binary file" ] #if [ #data #true ] [ #scope:configuration:debug ] #print_line [ #scope:status:output ] #end #string [ #data "failed to build " ] [ #scope:name ] #modify [ #data #scope:_7 ] [ #last ] #error [ #scope:_7 ] #end ] clean [ [ #single name [ string ] ] [ #single configuration [ map ] ] #call [ #data shego:print_clean ] [ #data "removing build files..." ] #string [ #data "rm -rf " ] [ #scope:configuration:output ] [ #data "*" ] #modify [ #data #scope:_0 ] [ #last ] #modify [ #data #scope:command ] [ #scope:_0 ] #system [ #data "bash" ] [ #data "-c" ] [ #scope:command ] ] new [ [ #single arguments [ list ] ] #boolean [ #data #not_empty ] [ #scope:arguments ] #modify [ #data #scope:_0 ] [ #last ] #ensure [ #data #true ] [ #scope:_0 ] [ #data "expected a project name" ] #length [ #scope:arguments ] #modify [ #data #scope:_1 ] [ #last ] #boolean [ #data #smaller ] [ #scope:_1 ] [ #data 3 ] #modify [ #data #scope:_2 ] [ #last ] #ensure [ #data #true ] [ #scope:_2 ] [ #data "too many parameters for new provided" ] #boolean [ #data #file_present ] [ #scope:arguments:1 ] #if [ #data #true ] [ #last ] #print_line [ #data "directory already exists, nothing was changed" ] #return #end #call [ #data shego:append_separator ] [ #scope:arguments:1 ] [ #data '/' ] #modify [ #data #scope:_3 ] [ #last ] #modify [ #data #scope:woring_directory ] [ #scope:_3 ] #length [ #scope:arguments ] #modify [ #data #scope:_4 ] [ #last ] #boolean [ #data #bigger ] [ #scope:_4 ] [ #data 1 ] #if [ #data #true ] [ #last ] #call [ #data shego:append_separator ] [ #scope:arguments:2 ] [ #data '/' ] #modify [ #data #scope:_5 ] [ #last ] #modify [ #data #scope:source_directory ] [ #scope:_5 ] #string [ #scope:woring_directory ] [ #scope:source_directory ] [ #data "main." ] [ #root:extentions:cipher ] #modify [ #data #scope:_6 ] [ #last ] #modify [ #data #scope:path ] [ #scope:_6 ] #else #string [ #scope:woring_directory ] [ #data "source/main." ] [ #root:extentions:cipher ] #modify [ #data #scope:_7 ] [ #last ] #modify [ #data #scope:path ] [ #scope:_7 ] #end #modify [ #data #scope:new_file ] [ #data "label main: Function(arguments: Vector<String>) -> Integer := {\n\n    print_line?(\"hello, world!\")\n    return 0\n}\n" ] #call [ #data shego:write_create ] [ #scope:path ] [ #scope:new_file ] #string [ #data "created main file at " ] [ #scope:path ] #modify [ #data #scope:_8 ] [ #last ] #call [ #data shego:print_success ] [ #scope:_8 ] ] rebuild [ [ #single name [ string ] ] [ #single configuration [ map ] ] #call [ #data clean ] [ #scope:name ] [ #scope:configuration ] #call [ #data build ] [ #scope:name ] [ #scope:configuration ] ] reverify [ [ #single name [ string ] ] [ #single configuration [ map ] ] #call [ #data clean ] [ #scope:name ] [ #scope:configuration ] #call [ #data verify ] [ #scope:name ] [ #scope:configuration ] ] run [ [ #single name [ string ] ] [ #single configuration [ map ] ] #call [ #data build ] [ #scope:name ] [ #scope:configuration ] #string [ #scope:configuration:output ] [ #scope:name ] [ #data '.' ] [ #root:extentions:binary ] #modify [ #data #scope:_0 ] [ #last ] #modify [ #data #scope:binary_file ] [ #scope:_0 ] #system [ #data "bash" ] [ #data "-c" ] [ #scope:binary_file ] #modify [ #data #scope:_1 ] [ #last ] #modify [ #data #scope:status ] [ #scope:_1 ] ] show_help [ #print_line #print_line [ #data "usage:" ] #print_line [ #data "  $            cipher <function> [options]" ] #print_line #print_line [ #data "functions:" ] #print_line [ #data "  verify       compile without building a binary" ] #print_line [ #data "  build        compile and invoke next stage compilers" ] #print_line [ #data "  clean        remove all build files" ] #print_line [ #data "  reverify     clean and verify" ] #print_line [ #data "  rebuild      clean and build" ] #print_line #print_line [ #data "options:" ] #print_line [ #data " -h --help     show help menu" ] #print_line [ #data " -o --output   set output directory" ] #print_line [ #data " -s --source   set source directory" ] #print_line [ #data " -S --symbols  export symbols when creating the binary" ] #print_line [ #data " -d --debug    enable debug mode" ] #print_line #print_line [ #data "contact:" ] #print_line [ #data "  #            github.com/ve5li/cipher" ] #print_line [ #data "  @            ve5li@tuta.io" ] #print_line ] verify [ [ #single name [ string ] ] [ #single configuration [ map ] ] #call [ #data shego:print_debug ] [ #data "loading language..." ] #modify [ #data #scope:compiler_core ] [ #data [ tokenizer parser ] ] #modify [ #data #scope:compiler_pipeline ] [ #data [ register infer resolve generate ] ] #map [ #data #pipeline ] [ #scope:compiler_pipeline ] [ #data debug ] [ #scope:configuration:debug ] #modify [ #data #scope:_0 ] [ #last ] #modify [ #data #scope:compiler ] [ #scope:_0 ] #string [ #root:directories:utility ] [ #data "library." ] [ #root:extentions:data ] #modify [ #data #scope:_1 ] [ #last ] #modify [ #data #scope:library_path ] [ #scope:_1 ] #read_map [ #scope:library_path ] #modify [ #data #scope:_2 ] [ #last ] #merge [ #scope:compiler ] [ #scope:_2 ] #modify [ #data #scope:_3 ] [ #last ] #modify [ #data #scope:compiler ] [ #scope:_3 ] #iterate [ #scope:compiler_core ] #modify [ #data #scope:key ] [ #last:key ] [ #data #scope:core ] [ #last:value ] #string [ #root:directories:core ] [ #scope:core ] [ #data '.' ] [ #root:extentions:data ] #modify [ #data #scope:_4 ] [ #last ] #modify [ #data #scope:path ] [ #scope:_4 ] #read_map [ #scope:path ] #modify [ #data #scope:_5 ] [ #last ] #merge [ #scope:compiler ] [ #scope:_5 ] #modify [ #data #scope:_6 ] [ #last ] #modify [ #data #scope:compiler ] [ #scope:_6 ] #end #iterate [ #scope:compiler_pipeline ] #modify [ #data #scope:key ] [ #last:key ] [ #data #scope:pass ] [ #last:value ] #string [ #root:directories:passes ] [ #scope:pass ] [ #data '.' ] [ #root:extentions:data ] #modify [ #data #scope:_7 ] [ #last ] #modify [ #data #scope:path ] [ #scope:_7 ] #read_map [ #scope:path ] #modify [ #data #scope:_8 ] [ #last ] #merge [ #scope:compiler ] [ #scope:_8 ] #modify [ #data #scope:_9 ] [ #last ] #modify [ #data #scope:compiler ] [ #scope:_9 ] #end #string [ #scope:configuration:source ] [ #data "main." ] [ #root:extentions:cipher ] #modify [ #data #scope:_10 ] [ #last ] #modify [ #data #scope:source_file ] [ #scope:_10 ] #read_file [ #scope:source_file ] #modify [ #data #scope:_11 ] [ #last ] #modify [ #data #scope:file_content ] [ #scope:_11 ] #tokenize [ #scope:compiler ] [ #scope:file_content ] [ #scope:source_file ] [ #data !false ] [ #data !true ] #modify [ #data #scope:_12 ] [ #last ] #modify [ #data #scope:tokenizer_data ] [ #scope:_12 ] #parse [ #scope:compiler ] [ #scope:tokenizer_data:token_stream ] [ #scope:tokenizer_data:registry ] #modify [ #data #scope:_13 ] [ #last ] #modify [ #data #scope:parser_data ] [ #scope:_13 ] #build [ #scope:compiler ] [ #scope:parser_data ] #modify [ #data #scope:_14 ] [ #last ] #modify [ #data #scope:build_data ] [ #scope:_14 ] #string [ #scope:configuration:output ] [ #scope:name ] [ #data '.' ] [ #root:extentions:intermediate ] #modify [ #data #scope:_15 ] [ #last ] #modify [ #data #scope:output_file ] [ #scope:_15 ] #call [ #data shego:write_create ] [ #scope:output_file ] [ #scope:build_data:code ] ] #main [ [ #single name [ string ] ] [ #single function [ string ] ] [ #list arguments [ string ] ] #time #modify [ #data #scope:_0 ] [ #last ] #modify [ #data #scope:start_time ] [ #scope:_0 ] #string [ #root:directories:utility ] [ #data "library." ] [ #root:extentions:data ] #modify [ #data #scope:_1 ] [ #last ] #modify [ #data #scope:library_path ] [ #scope:_1 ] #read_map [ #scope:library_path ] #modify [ #data #scope:_2 ] [ #last ] #merge [ #root ] [ #scope:_2 ] #modify [ #data #scope:_3 ] [ #last ] #modify [ #data #root ] [ #scope:_3 ] #call [ #data shego:generate_colors ] #boolean [ #data #equals ] [ #scope:function ] [ #data "new" ] #if [ #data #true ] [ #last ] #call [ #data new ] [ #scope:arguments ] #return #end #modify [ #data #scope:user_functions ] [ #data { "build" build "clean" clean "rebuild" rebuild "reverify" reverify "run" run "verify" verify } ] #call [ #data shego:process_arguments ] [ #root:command_lookup ] [ #scope:arguments ] #modify [ #data #scope:_4 ] [ #last ] #modify [ #data #scope:configuration ] [ #scope:_4 ] #modify [ #data #root:debug ] [ #scope:configuration:debug ] #if [ #data #true ] [ #scope:configuration:help ] #call [ #data show_help ] #return #end #boolean [ #data #not_present ] [ #scope:user_functions ] [ #scope:function ] #if [ #data #true ] [ #last ] #string [ #data "compiler has no function called " ] [ #scope:function ] #modify [ #data #scope:_5 ] [ #last ] #call [ #data shego:print_error ] [ #scope:_5 ] #call [ #data show_help ] #return #end #string [ #data "running " ] [ #scope:function ] [ #data "..." ] #modify [ #data #scope:_6 ] [ #last ] #call [ #data shego:print_debug ] [ #scope:_6 ] #index [ #scope:user_functions ] [ #scope:function ] #modify [ #data #scope:_7 ] [ #last ] #call [ #scope:_7 ] [ #scope:name ] [ #scope:configuration ] #if [ #data #true ] [ #scope:configuration:lucky ] #call [ #data shego:print_lucky ] #end #time #modify [ #data #scope:_8 ] [ #last ] #subtract [ #scope:_8 ] [ #scope:start_time ] #modify [ #data #scope:_9 ] [ #last ] #divide [ #scope:_9 ] [ #data 1000.0 ] #modify [ #data #scope:_10 ] [ #last ] #modify [ #data #scope:delta_time ] [ #scope:_10 ] #string [ #scope:delta_time ] #modify [ #data #scope:_11 ] [ #last ] #slice [ #scope:_11 ] [ #data 1 ] [ #data 3 ] #modify [ #data #scope:_12 ] [ #last ] #modify [ #data #scope:formatted ] [ #scope:_12 ] #string [ #data "completed in " ] [ #scope:formatted ] [ #data "s" ] #modify [ #data #scope:_13 ] [ #last ] #call [ #data shego:print_success ] [ #scope:_13 ] ] } 